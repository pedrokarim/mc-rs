<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plugins — MC-RS Documentation</title>
  <link rel="stylesheet" href="../style.css">
</head>
<body>

<!-- Header -->
<header class="site-header">
  <button class="hamburger" aria-label="Menu">&#9776;</button>
  <a href="../" class="header-logo">
    <svg viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
      <rect x="2" y="8" width="20" height="20" rx="2" fill="#4ecca3" opacity="0.3"/>
      <rect x="8" y="2" width="20" height="20" rx="2" fill="#4ecca3" opacity="0.6"/>
      <rect x="6" y="6" width="16" height="16" rx="2" fill="#4ecca3"/>
      <rect x="10" y="10" width="4" height="4" fill="#0f0f1a"/>
      <rect x="18" y="10" width="4" height="4" fill="#0f0f1a"/>
      <rect x="12" y="16" width="8" height="3" rx="1" fill="#0f0f1a"/>
    </svg>
    <span>MC<span class="accent">-RS</span></span>
  </a>
  <div class="search-wrapper">
    <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
    <input type="text" class="search-input" placeholder="Search documentation...">
    <span class="search-shortcut">/</span>
    <div class="search-results"></div>
  </div>
</header>

<!-- Sidebar -->
<nav class="sidebar">
  <div class="sidebar-section">
    <div class="sidebar-section-title">Getting Started</div>
    <a href="../" class="sidebar-link">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
      Home
    </a>
    <a href="overview.html" class="sidebar-link">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4m0-4h.01"/></svg>
      Overview
    </a>
    <a href="architecture.html" class="sidebar-link">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="6" height="6" rx="1"/><rect x="16" y="3" width="6" height="6" rx="1"/><rect x="16" y="15" width="6" height="6" rx="1"/><path d="M8 10h4m0 0v-4m0 4v4m0-4h4"/></svg>
      Architecture
    </a>
  </div>
  <div class="sidebar-section">
    <div class="sidebar-section-title">Core Systems</div>
    <a href="protocol.html" class="sidebar-link">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/><polyline points="13 2 13 9 20 9"/></svg>
      Protocol
    </a>
    <a href="networking.html" class="sidebar-link">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12.55a11 11 0 0 1 14.08 0"/><path d="M1.42 9a16 16 0 0 1 21.16 0"/><path d="M8.53 16.11a6 6 0 0 1 6.95 0"/><circle cx="12" cy="20" r="1"/></svg>
      Networking
    </a>
    <a href="world.html" class="sidebar-link">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
      World
    </a>
    <a href="entities.html" class="sidebar-link">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/></svg>
      Entities
    </a>
  </div>
  <div class="sidebar-section">
    <div class="sidebar-section-title">Gameplay</div>
    <a href="gameplay.html" class="sidebar-link">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
      Gameplay
    </a>
    <a href="commands.html" class="sidebar-link">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/></svg>
      Commands
    </a>
    <a href="plugins.html" class="sidebar-link active">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v6m0 8v6M4.93 4.93l4.24 4.24m5.66 5.66 4.24 4.24M2 12h6m8 0h6M4.93 19.07l4.24-4.24m5.66-5.66 4.24-4.24"/></svg>
      Plugins
    </a>
  </div>
  <div class="sidebar-section">
    <div class="sidebar-section-title">Operations</div>
    <a href="configuration.html" class="sidebar-link">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
      Configuration
    </a>
    <a href="security.html" class="sidebar-link">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
      Security
    </a>
    <a href="performance.html" class="sidebar-link">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
      Performance
    </a>
  </div>
  <div class="sidebar-section">
    <div class="sidebar-section-title">Links</div>
    <a href="https://github.com/pedrokarim/mc-rs" class="sidebar-link" target="_blank" rel="noopener">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z"/></svg>
      GitHub
    </a>
  </div>
</nav>

<div class="sidebar-overlay"></div>

<!-- Main Content -->
<main class="main-content">
  <div class="content-inner">

    <h1>Plugin System</h1>
    <p class="page-subtitle">Extensible plugin architecture with Rust API, WASM runtime, Lua scripting, and Forms UI.</p>

    <!-- Architecture -->
    <h2>Architecture</h2>
    <p>The <code>PluginManager</code> orchestrates three distinct plugin runtimes, providing a unified event system and action queue. Plugins operate on a produce/consume model: they receive events from the server, execute their logic, and return <code>PendingAction</code> values that the server processes on the next tick.</p>

    <div class="card-grid">
      <div class="card">
        <div class="card-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
        </div>
        <h3>Rust API</h3>
        <p>Native Rust plugins via the <code>mc-rs-plugin-api</code> crate. Highest performance, full type safety, compiled into the server binary.</p>
      </div>
      <div class="card">
        <div class="card-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
        </div>
        <h3>WASM Runtime</h3>
        <p>Sandboxed WebAssembly plugins via <code>wasmtime</code>. Language-agnostic (Rust, C, AssemblyScript, etc.), secure isolation, hot-reloadable.</p>
      </div>
      <div class="card">
        <div class="card-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>
        </div>
        <h3>Lua Scripts</h3>
        <p>Lightweight scripting via <code>mlua</code>. Quick customizations, easy to write, no compilation step, hot-reloadable.</p>
      </div>
    </div>

    <h3>Action Queue Pattern</h3>
    <p>Plugins never modify server state directly. Instead, they return <code>PendingAction</code> values that describe what should happen. The server collects these actions and processes them safely on the main thread.</p>

    <pre><code><span class="cm">// Action flow: Plugin → PendingAction → Server</span>
<span class="kw">enum</span> <span class="ty">PendingAction</span> {
    <span class="fn">SendMessage</span> { target: <span class="ty">String</span>, message: <span class="ty">String</span> },
    <span class="fn">Kick</span> { player: <span class="ty">String</span>, reason: <span class="ty">String</span> },
    <span class="fn">SetBlock</span> { pos: <span class="ty">BlockPos</span>, block: <span class="ty">String</span> },
    <span class="fn">GiveItem</span> { player: <span class="ty">String</span>, item: <span class="ty">String</span>, count: <span class="ty">u32</span> },
    <span class="fn">RunCommand</span> { command: <span class="ty">String</span> },
    <span class="fn">ShowForm</span> { player: <span class="ty">String</span>, form: <span class="ty">FormData</span> },
    <span class="fn">CancelEvent</span>,
    <span class="cm">// ... more actions</span>
}</code></pre>

    <div class="alert alert-info">
      <strong>Thread safety:</strong> The <code>ServerApiImpl</code> provides read-only access to server state (player list, world data, config). All mutations go through the action queue, ensuring plugins cannot cause data races or corrupt shared state.
    </div>

    <!-- Event Types -->
    <h2>Event Types</h2>
    <p>The server dispatches <strong>15 event types</strong> to plugins through hooks in <code>connection.rs</code>. Each event carries contextual data and a cancellable flag &mdash; if a plugin returns <code>CancelEvent</code>, the action is suppressed.</p>

    <table>
      <thead>
        <tr><th>Event</th><th>Trigger</th><th>Cancellable</th></tr>
      </thead>
      <tbody>
        <tr><td><strong>PlayerJoin</strong></td><td>Player completes login and enters the Playing state</td><td>Yes</td></tr>
        <tr><td><strong>PlayerLeave</strong></td><td>Player disconnects or is kicked</td><td>No</td></tr>
        <tr><td><strong>PlayerChat</strong></td><td>Player sends a chat message</td><td>Yes</td></tr>
        <tr><td><strong>PlayerCommand</strong></td><td>Player executes a / command</td><td>Yes</td></tr>
        <tr><td><strong>PlayerMove</strong></td><td>Player sends a PlayerAuthInput movement packet</td><td>Yes</td></tr>
        <tr><td><strong>PlayerBreakBlock</strong></td><td>Player finishes mining a block</td><td>Yes</td></tr>
        <tr><td><strong>PlayerPlaceBlock</strong></td><td>Player places a block via InventoryTransaction</td><td>Yes</td></tr>
        <tr><td><strong>PlayerAttack</strong></td><td>Player attacks another entity</td><td>Yes</td></tr>
        <tr><td><strong>PlayerDeath</strong></td><td>Player health reaches zero</td><td>No</td></tr>
        <tr><td><strong>MobSpawn</strong></td><td>A mob is naturally spawned or summoned</td><td>Yes</td></tr>
        <tr><td><strong>MobDeath</strong></td><td>A mob's health reaches zero</td><td>No</td></tr>
        <tr><td><strong>BlockUpdate</strong></td><td>A block state changes (redstone, fluid, tick)</td><td>Yes</td></tr>
        <tr><td><strong>WeatherChange</strong></td><td>Weather transitions to a new state</td><td>Yes</td></tr>
        <tr><td><strong>ServerTick</strong></td><td>Fires every game tick (50ms / 20 TPS)</td><td>No</td></tr>
        <tr><td><strong>FormResponse</strong></td><td>Player submits a form (ModalFormResponse 0x65)</td><td>No</td></tr>
      </tbody>
    </table>

    <div class="alert alert-warn">
      <strong>Performance note:</strong> The <code>ServerTick</code> event fires 20 times per second. Plugins should keep tick handlers lightweight to avoid slowing down the game loop. Heavy computation should be deferred or spread across multiple ticks using the scheduler.
    </div>

    <!-- Rust Plugin API -->
    <h2>Rust Plugin API</h2>
    <p>The <code>mc-rs-plugin-api</code> crate defines the core traits and types for native Rust plugins. Rust plugins are compiled into the server binary and have the highest performance.</p>

    <h3>Plugin Trait</h3>
    <pre><code><span class="kw">pub trait</span> <span class="ty">Plugin</span>: <span class="ty">Send</span> + <span class="ty">Sync</span> {
    <span class="cm">/// Called when the plugin is loaded</span>
    <span class="kw">fn</span> <span class="fn">on_enable</span>(&amp;<span class="kw">mut</span> <span class="kw">self</span>, api: &amp;<span class="kw">dyn</span> <span class="ty">ServerApi</span>);

    <span class="cm">/// Called when the plugin is unloaded</span>
    <span class="kw">fn</span> <span class="fn">on_disable</span>(&amp;<span class="kw">mut</span> <span class="kw">self</span>);

    <span class="cm">/// Called for each server event</span>
    <span class="kw">fn</span> <span class="fn">on_event</span>(
        &amp;<span class="kw">mut</span> <span class="kw">self</span>,
        event: &amp;<span class="ty">PluginEvent</span>,
        api: &amp;<span class="kw">dyn</span> <span class="ty">ServerApi</span>,
    ) -&gt; <span class="ty">Vec</span>&lt;<span class="ty">PendingAction</span>&gt;;
}</code></pre>

    <h3>ServerApi Trait</h3>
    <p>Provides read-only access to server state. Plugins use this to query information without direct mutation.</p>

    <pre><code><span class="kw">pub trait</span> <span class="ty">ServerApi</span> {
    <span class="kw">fn</span> <span class="fn">get_online_players</span>(&amp;<span class="kw">self</span>) -&gt; <span class="ty">Vec</span>&lt;<span class="ty">PlayerInfo</span>&gt;;
    <span class="kw">fn</span> <span class="fn">get_player_position</span>(&amp;<span class="kw">self</span>, name: &amp;<span class="ty">str</span>) -&gt; <span class="ty">Option</span>&lt;<span class="ty">Vec3</span>&gt;;
    <span class="kw">fn</span> <span class="fn">get_block_at</span>(&amp;<span class="kw">self</span>, pos: <span class="ty">BlockPos</span>) -&gt; <span class="ty">Option</span>&lt;<span class="ty">String</span>&gt;;
    <span class="kw">fn</span> <span class="fn">get_world_time</span>(&amp;<span class="kw">self</span>) -&gt; <span class="ty">u64</span>;
    <span class="kw">fn</span> <span class="fn">get_config_value</span>(&amp;<span class="kw">self</span>, key: &amp;<span class="ty">str</span>) -&gt; <span class="ty">Option</span>&lt;<span class="ty">String</span>&gt;;
    <span class="cm">// ... more query methods</span>
}</code></pre>

    <h3>Example Plugin</h3>
    <pre><code><span class="kw">pub struct</span> <span class="ty">WelcomePlugin</span>;

<span class="kw">impl</span> <span class="ty">Plugin</span> <span class="kw">for</span> <span class="ty">WelcomePlugin</span> {
    <span class="kw">fn</span> <span class="fn">on_enable</span>(&amp;<span class="kw">mut</span> <span class="kw">self</span>, _api: &amp;<span class="kw">dyn</span> <span class="ty">ServerApi</span>) {
        <span class="fn">println!</span>(<span class="str">"WelcomePlugin enabled!"</span>);
    }

    <span class="kw">fn</span> <span class="fn">on_disable</span>(&amp;<span class="kw">mut</span> <span class="kw">self</span>) {}

    <span class="kw">fn</span> <span class="fn">on_event</span>(
        &amp;<span class="kw">mut</span> <span class="kw">self</span>,
        event: &amp;<span class="ty">PluginEvent</span>,
        _api: &amp;<span class="kw">dyn</span> <span class="ty">ServerApi</span>,
    ) -&gt; <span class="ty">Vec</span>&lt;<span class="ty">PendingAction</span>&gt; {
        <span class="kw">match</span> event {
            <span class="ty">PluginEvent</span>::<span class="fn">PlayerJoin</span> { name, .. } =&gt; {
                <span class="kw">vec</span>![<span class="ty">PendingAction</span>::<span class="fn">SendMessage</span> {
                    target: name.<span class="fn">clone</span>(),
                    message: <span class="fn">format!</span>(<span class="str">"Welcome, {}!"</span>, name),
                }]
            }
            _ =&gt; <span class="kw">vec</span>[],
        }
    }
}</code></pre>

    <!-- WASM Plugins -->
    <h2>WASM Plugins</h2>
    <p>The <code>mc-rs-plugin-wasm</code> crate provides a sandboxed WebAssembly runtime powered by <strong>wasmtime</strong>. WASM plugins can be written in any language that compiles to WASM (Rust, C/C++, AssemblyScript, Go, etc.).</p>

    <h3>Manifest</h3>
    <p>Each WASM plugin requires a <code>manifest.json</code> file alongside the <code>.wasm</code> binary:</p>

    <pre><code>{
    <span class="str">"name"</span>: <span class="str">"my-wasm-plugin"</span>,
    <span class="str">"version"</span>: <span class="str">"1.0.0"</span>,
    <span class="str">"entry_point"</span>: <span class="str">"plugin.wasm"</span>
}</code></pre>

    <h3>Host Functions</h3>
    <p>WASM plugins interact with the server through a set of host functions exposed by the runtime. These functions provide the same capabilities as the Rust <code>ServerApi</code>, but through a WASM-compatible ABI.</p>

    <ul>
      <li><strong><code>host_get_players()</code></strong> &mdash; Returns the list of connected player names</li>
      <li><strong><code>host_send_message(player, msg)</code></strong> &mdash; Queues a chat message to a player</li>
      <li><strong><code>host_get_block(x, y, z)</code></strong> &mdash; Queries the block at a world position</li>
      <li><strong><code>host_set_block(x, y, z, block)</code></strong> &mdash; Queues a block placement action</li>
      <li><strong><code>host_get_player_pos(player)</code></strong> &mdash; Returns a player's current position</li>
      <li><strong><code>host_run_command(cmd)</code></strong> &mdash; Queues a server command for execution</li>
      <li><strong><code>host_show_form(player, form_json)</code></strong> &mdash; Queues a form UI to display</li>
    </ul>

    <div class="alert alert-info">
      <strong>Sandboxed execution:</strong> WASM plugins run in a fully isolated sandbox. They cannot access the filesystem, network, or any server memory directly. All interaction goes through the host function ABI, which validates inputs and queues actions safely.
    </div>

    <!-- Lua Scripts -->
    <h2>Lua Scripts</h2>
    <p>The <code>mc-rs-plugin-lua</code> crate embeds the <strong>mlua</strong> Lua runtime for lightweight scripting. Lua scripts are ideal for quick server customizations, event responses, and simple game logic without a compilation step.</p>

    <h3>Script Structure</h3>
    <pre><code><span class="cm">-- plugins/greet.lua</span>
<span class="kw">function</span> <span class="fn">on_player_join</span>(player_name)
    <span class="fn">send_message</span>(player_name, <span class="str">"Welcome to the server, "</span> .. player_name .. <span class="str">"!"</span>)
    <span class="fn">log</span>(<span class="str">"Player joined: "</span> .. player_name)
<span class="kw">end</span>

<span class="kw">function</span> <span class="fn">on_player_chat</span>(player_name, message)
    <span class="kw">if</span> message == <span class="str">"!ping"</span> <span class="kw">then</span>
        <span class="fn">send_message</span>(player_name, <span class="str">"Pong!"</span>)
        <span class="kw">return true</span>  <span class="cm">-- cancel the chat message</span>
    <span class="kw">end</span>
    <span class="kw">return false</span>
<span class="kw">end</span></code></pre>

    <h3>Host Function Bindings</h3>
    <p>Lua scripts have access to the same host functions as WASM plugins, exposed as global Lua functions. The bindings are registered by <code>mc-rs-plugin-lua</code> when the Lua VM is initialized:</p>

    <ul>
      <li><code>send_message(player, msg)</code> &mdash; Send a chat message to a player</li>
      <li><code>broadcast(msg)</code> &mdash; Broadcast a message to all players</li>
      <li><code>kick(player, reason)</code> &mdash; Kick a player from the server</li>
      <li><code>get_players()</code> &mdash; Returns a table of connected player names</li>
      <li><code>get_block(x, y, z)</code> &mdash; Query the block at a position</li>
      <li><code>set_block(x, y, z, block)</code> &mdash; Queue a block placement</li>
      <li><code>run_command(cmd)</code> &mdash; Execute a server command</li>
      <li><code>show_form(player, form_json)</code> &mdash; Display a form UI</li>
      <li><code>log(msg)</code> &mdash; Log a message to the server console</li>
    </ul>

    <!-- Forms UI -->
    <h2>Forms UI</h2>
    <p>MC-RS implements the Bedrock Forms system using <code>ModalFormRequest</code> (0x64) and <code>ModalFormResponse</code> (0x65) packets. Forms allow plugins to present interactive UIs to players without client-side mods.</p>

    <h3>Form Types</h3>
    <div class="card-grid">
      <div class="card">
        <div class="card-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M9 9h6v6H9z"/></svg>
        </div>
        <h3>SimpleForm</h3>
        <p>Title, body text, and a list of buttons. The player clicks one button, and the server receives the button index. Ideal for menus and selections.</p>
      </div>
      <div class="card">
        <div class="card-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>
        </div>
        <h3>ModalForm</h3>
        <p>Title, body text, and two buttons (confirm/cancel). Returns a boolean response. Ideal for yes/no confirmations and prompts.</p>
      </div>
      <div class="card">
        <div class="card-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
        </div>
        <h3>CustomForm</h3>
        <p>Rich form with text inputs, dropdowns, sliders, toggles, and labels. Returns an array of values. Ideal for configuration and data entry.</p>
      </div>
    </div>

    <h3>Builder API</h3>
    <p>Forms are constructed using a fluent builder pattern that serializes to the JSON format expected by the Bedrock client:</p>

    <pre><code><span class="cm">// SimpleForm with buttons</span>
<span class="kw">let</span> form = <span class="ty">SimpleFormBuilder</span>::<span class="fn">new</span>(<span class="str">"Teleport Menu"</span>)
    .<span class="fn">body</span>(<span class="str">"Select a destination:"</span>)
    .<span class="fn">button</span>(<span class="str">"Spawn"</span>)
    .<span class="fn">button</span>(<span class="str">"Nether Portal"</span>)
    .<span class="fn">button</span>(<span class="str">"End Portal"</span>)
    .<span class="fn">build</span>();

<span class="cm">// CustomForm with inputs</span>
<span class="kw">let</span> form = <span class="ty">CustomFormBuilder</span>::<span class="fn">new</span>(<span class="str">"Settings"</span>)
    .<span class="fn">toggle</span>(<span class="str">"Enable PvP"</span>, <span class="kw">true</span>)
    .<span class="fn">slider</span>(<span class="str">"View Distance"</span>, <span class="num">2.0</span>, <span class="num">32.0</span>, <span class="num">1.0</span>, <span class="num">12.0</span>)
    .<span class="fn">dropdown</span>(<span class="str">"Difficulty"</span>, <span class="kw">vec</span>![<span class="str">"Peaceful"</span>, <span class="str">"Easy"</span>, <span class="str">"Normal"</span>, <span class="str">"Hard"</span>], <span class="num">2</span>)
    .<span class="fn">input</span>(<span class="str">"MOTD"</span>, <span class="str">"Enter server message..."</span>, <span class="str">""</span>)
    .<span class="fn">build</span>();

<span class="cm">// ModalForm with yes/no</span>
<span class="kw">let</span> form = <span class="ty">ModalFormBuilder</span>::<span class="fn">new</span>(<span class="str">"Confirm"</span>)
    .<span class="fn">body</span>(<span class="str">"Are you sure you want to reset?"</span>)
    .<span class="fn">button1</span>(<span class="str">"Yes, reset"</span>)
    .<span class="fn">button2</span>(<span class="str">"Cancel"</span>)
    .<span class="fn">build</span>();</code></pre>

    <h3>Response Handling</h3>
    <p>When a player submits a form, the server receives a <code>ModalFormResponse</code> packet (0x65). The response is parsed into a <code>FormResponse</code> and dispatched as a <code>PluginEvent::FormResponse</code> event. Pending forms are tracked per-player in <code>pending_forms</code> to match responses to the correct form.</p>

    <!-- Behavior Packs -->
    <h2>Behavior Packs</h2>
    <p>The <code>mc-rs-behavior-pack</code> crate provides a JSON-based data pack system for extending game content without code. Behavior packs define entities, items, blocks, recipes, and loot tables using the same JSON format as vanilla Bedrock behavior packs.</p>

    <h3>Pack Structure</h3>
    <pre><code>packs/
  my-pack/
    manifest.json
    entities/
      custom_mob.json
    items/
      custom_sword.json
    blocks/
      custom_ore.json
    recipes/
      custom_recipe.json
    loot_tables/
      custom_loot.json</code></pre>

    <h3>Supported Definitions</h3>
    <table>
      <thead>
        <tr><th>Type</th><th>Directory</th><th>Description</th></tr>
      </thead>
      <tbody>
        <tr><td><strong>Entity</strong></td><td><code>entities/</code></td><td>Custom mob definitions with components, behaviors, and attributes</td></tr>
        <tr><td><strong>Item</strong></td><td><code>items/</code></td><td>Custom items with categories, properties, and use behaviors</td></tr>
        <tr><td><strong>Block</strong></td><td><code>blocks/</code></td><td>Custom blocks with states, textures, and physics properties</td></tr>
        <tr><td><strong>Recipe</strong></td><td><code>recipes/</code></td><td>Crafting, smelting, and other recipe types</td></tr>
        <tr><td><strong>Loot Table</strong></td><td><code>loot_tables/</code></td><td>Drop tables for mobs, chests, and block breaking</td></tr>
      </tbody>
    </table>

    <h3>Registry Extension</h3>
    <p>Behavior pack definitions are loaded at startup and merged into the server's registries (ItemRegistry, RecipeRegistry, MobRegistry, etc.). This means custom items appear in creative inventory, custom recipes work in crafting tables, and custom mobs can be summoned with <code>/summon</code>.</p>

    <p>Packs are configured in the <code>[packs]</code> section of <code>server.toml</code>:</p>

    <pre><code><span class="cm"># server.toml</span>
[packs]
behavior_packs = [<span class="str">"packs/my-pack"</span>, <span class="str">"packs/another-pack"</span>]</code></pre>

    <div class="alert alert-info">
      <strong>Transfer packets:</strong> Three transfer-related packets (0x52-0x54) are implemented for cross-server resource pack management, allowing players to move between servers with different behavior pack configurations.
    </div>

    <!-- Hot Reload -->
    <h2>Hot Reload</h2>
    <p>The <code>/reload</code> command performs a full hot-reload of all plugins without requiring a server restart. This is invaluable during development and for live servers that need to update plugin logic.</p>

    <h3>Reload Process</h3>
    <ol>
      <li><strong>Unload all plugins</strong> &mdash; Calls <code>on_disable()</code> on each loaded plugin and clears the plugin list</li>
      <li><strong>Re-create runtimes</strong> &mdash; Destroys and re-creates the wasmtime Engine and Lua VM to ensure a clean state</li>
      <li><strong>Load WASM plugins</strong> &mdash; Scans the plugins directory, reads manifests, compiles and instantiates WASM modules</li>
      <li><strong>Load Lua plugins</strong> &mdash; Scans for <code>.lua</code> files and loads them into the fresh Lua VM</li>
      <li><strong>Enable all</strong> &mdash; Calls <code>on_enable()</code> on each newly loaded plugin</li>
      <li><strong>Reload configs</strong> &mdash; Re-reads plugin configuration files</li>
    </ol>

    <pre><code><span class="cm">// PluginManager reload flow</span>
<span class="kw">impl</span> <span class="ty">PluginManager</span> {
    <span class="kw">pub fn</span> <span class="fn">reload</span>(&amp;<span class="kw">mut</span> <span class="kw">self</span>) {
        <span class="kw">self</span>.<span class="fn">unload_all</span>();           <span class="cm">// on_disable() for each plugin</span>
        <span class="kw">self</span>.<span class="fn">recreate_engine</span>();       <span class="cm">// Fresh wasmtime Engine</span>
        <span class="kw">self</span>.<span class="fn">load_wasm_plugins</span>();     <span class="cm">// Scan & compile .wasm files</span>
        <span class="kw">self</span>.<span class="fn">load_lua_plugins</span>();      <span class="cm">// Scan & load .lua files</span>
        <span class="kw">self</span>.<span class="fn">enable_all</span>();            <span class="cm">// on_enable() for each plugin</span>
        <span class="kw">self</span>.<span class="fn">load_configs</span>();          <span class="cm">// Re-read plugin configs</span>
    }
}</code></pre>

    <div class="alert alert-warn">
      <strong>State loss:</strong> Hot-reloading destroys all plugin runtime state. Any in-memory data held by plugins (counters, caches, pending operations) will be lost. Plugins that need persistent state should save to files or use the server's configuration system.
    </div>

  </div>
</main>

<footer class="site-footer">
  MC-RS &mdash; Minecraft Bedrock Edition Server in Rust &mdash; <a href="https://github.com/pedrokarim/mc-rs">GitHub</a> &mdash; MIT License
</footer>

<script src="../nav.js"></script>
<script src="../search-data.js"></script>
<script src="../search.js"></script>
</body>
</html>